function getCSRFToken(){return getCookie('csrf_token');}
function getCookie(cname){var name=cname+"=";var decodedCookie=decodeURIComponent(document.cookie);var ca=decodedCookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' '){c=c.substring(1);}
if(c.indexOf(name)==0){return c.substring(name.length,c.length);}}
return"";}
$.ajaxSetup({beforeSend:function(xhr,settings){if(!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type)&&!this.crossDomain){xhr.setRequestHeader("X-CSRFToken",csrf_token);}}});$('#navbar').scrollToFixed();$('#shopping-cart').scrollToFixed({marginTop:75,zIndex:500,});$(window).on('load',function(){$(window).resize();});(function($){$.fn.shoppingCart=function(options){options=options||{};var opts=$.extend(true,$.fn.shoppingCart.defaults,options);var cartContent=$(this);this.numOfItems=parseInt(cartContent.find('[data-count]').attr('data-count'));var jsonRequest=function(url,type,data=null){return $.ajax({type:type,url:url,contentType:'application/json;charset=UTF-8',dataType:'json',data:data});};var htmlRequest=function(url,type){return $.ajax({type:type,url:url,contentType:'application/x-www-form-urlencoded; charset=UTF-8',dataType:'html'});}
var getNumOfItems=function(e){const url1=opts.urls.numberOfItems;const url2=cartContent.find('a').attr('href');jsonRequest(url1||url2,'GET').then(function(resp){e.updateNumOfItems(resp.numOfItems);});};var getCartContent=function(e,usePlaceholder=true){if(usePlaceholder){$(opts.delegates.cartContent).html(opts.messages.cartLoading);}
htmlRequest(opts.urls.cartContent||cartContent.find('a').attr('href'),'GET').then(function(resp){$(opts.delegates.cartContent).html(resp);opts.callbacks.onCartUpdated.call(e,resp);});}
var add=function(t,e){jsonRequest(e.attr('href'),'POST').then(function(resp){if(opts.callbacks.onAdd.call(t,e,resp)){t.updateNumOfItems(resp.shopItems);}else{t.numOfItems=resp.shopItems;}});};var remove=function(t,e){jsonRequest(e.attr('href'),'DELETE').then(function(resp){if(opts.callbacks.onClear.call(t,e,resp)){getCartContent(t,false);t.updateNumOfItems(resp.shopItems);}else{this.numOfItems=resp.shopItems;}});};this.hide=function(){cartContent.hide();};this.show=function(){cartContent.show();};this.updateNumOfItems=function(itemCnt){opts.callbacks.onCounterUpdated.call(this,itemCnt);this.numOfItems=itemCnt;cartContent.find('[data-count]').attr('data-count',itemCnt);};this.initialize=function(){var _that=this;getNumOfItems(this);$(cartContent).on('click',function(e){getCartContent(_that);});if(opts.delegates.buyButton){$(document.body).on('click',opts.delegates.buyButton,function(e){e.preventDefault();add(_that,$(e.currentTarget));});}
if(opts.delegates.removeButton){$(document.body).on('click',opts.delegates.removeButton,function(e){e.preventDefault();remove(_that,$(e.currentTarget));});}
if(opts.delegates.clearButton){$(document.body).on('click',opts.delegates.clearButton,function(e){e.preventDefault();remove(_that,$(e.currentTarget));});}
return this;};return this.initialize();};$.fn.shoppingCart.defaults={delegates:{cartModal:'#shopping-cart-modal',cartContent:'',buyButton:'.cart-add',clearButton:'#shopping-cart-clear',removeButton:'.cart-remove',},callbacks:{onCounterUpdated:function(e){},onCartUpdated:function(e){},onAdd:function(e,resp){return true;},onClear:function(e,resp){return true;},},urls:{numberOfItems:'/shop-api/cart',cartContent:'/shop/cart/mini',},messages:{cartLoading:'<div class="d-flex justify-content-center"><div class="spinner-border" role="status"><span class="sr-only">Loading...</span></div></div>',}};}(jQuery));