var initPayment=function(stripe_key,client_secret,success_url,processing_url,failed_url){var stripe=Stripe(stripe_key);var elements=stripe.elements();var submitButton=$('#submit-btn');var validateEmail=function(sEmail){var reEmail=/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/;if(!sEmail.match(reEmail)){return false;}
return true;}
var style={base:{lineHeight:'1.429'},invalid:{color:'#fa755a',iconColor:'#fa755a'}};var card=elements.create('card',{style:style,hidePostalCode:true,});card.mount('#card-element');card.on('change',({error})=>{const cardErrors=$('#card-errors');if(error){cardErrors.text(error.message);}else{cardErrors.text("");}
$(submitButton).prop('disabled',false);});$('input[name=email]').on('blur',function(e){const valid=validateEmail($(this).val());if(valid){$(this).next('.form-errors').text="";}else{$(this).next('.form-errors').text="Invalid email address";}});console.log("Test");$('select[name=country]').on('change',function(e){event.preventDefault();});$(submitButton).on('click',function(ev){ev.preventDefault();const nameField=$('input[name=name]');const emailField=$('input[name=email]');const country=$('select[name=country] option:selected').val();const postalCodeField=$('input[name=zip]');const addressField=$('input[name=address]');const cityField=$('input[name=city]');const tcField=$('#terms-condition input[type=checkbox]');const name=$(nameField).val();const address=$(addressField).val();const city=$(cityField).val();const email=$(emailField).val();const postalCode=$(postalCodeField).val();const tc=$(tcField).is(':checked');var error=false
if(name==""){$(nameField).next('.form-errors').text("Name must be filled out.");error=true;}else{$(nameField).next('.form-errors').text("");}
if(address==""){$(addressField).next('.form-errors').text("Address must be filled out.");error=true;}else{$(addressField).next('.form-errors').text("");}
if(city==""){$(cityField).next('.form-errors').text("City must be filled out.");error=true;}else{$(cityField).next('.form-errors').text("");}
if(email==""){$(emailField).next('.form-errors').text("Email must be filled out.");error=true;}else{const valid=validateEmail(email);if(valid){$(emailField).next('.form-errors').text("");}else{$(emailField).next('.form-errors').text("Invalid email address");error=true;}}
if(postalCode==""){$(postalCodeField).next('.form-errors').text("Postal Code must be filled out.");error=true;}else{$(postalCodeField).next('.form-errors').text("");}
if(!tc){var c=$(tcField).next('.form-errors');$(tcField).nextAll('.form-errors').text("You must aggree with the Terms & Conditions.")
error=true;}else{$(tcField).nextAll('.form-errors').text("");}
if(error)return;const shipping={name,address:{line1:address,city:city,state:"",postal_code:postalCode,country:country,}};submitButton.prop('disabled',true);$('.pay-btn-idle').css('display','none');$('.pay-btn-processing').css('display','block');stripe.confirmCardPayment(client_secret,{payment_method:{card:card,billing_details:{name:name,email:email,},},shipping,receipt_email:email}).then(function(result){const cardErrors=$('#card-errors');if(result.error){cardErrors.text(result.error.message);console.log(result.error.message);submitButton.prop('disabled',false);$('.pay-btn-idle').css('display','block');$('.pay-btn-processing').css('display','none');}else{cardErrors.text("");console.log(result);if(result.paymentIntent.status==='succeeded'){window.location.href=success_url;}else if(result.paymentIntent.status==='processing'){window.location.href=processing_url;}else{window.location.href=failed_url;}}});});};$('#checkout-modal-btn').click(function(e){var targetId=$(this).attr('data-target');var url=$(this).attr('href')
var targetDOM=$(targetId+' .modal-content')
targetDOM.html('<button class="btn btn-primary"><span class="spinner-border spinner-border-sm"></span>Loading..</button>');$.ajax({type:'GET',url:url,dataType:'html',success:function(data){targetDOM.html(data);},error:function(data){console.log(data.responseJSON);}});});var ua=navigator.userAgent,event=(ua.match(/iPad/i))?"touchstart":"click";var e=$('#cart tr.cart-table-album');$(document.body).on(event,'#cart tr.cart-table-album',function(){$(this).toggleClass("active","").nextUntil('.cart-table-album, .cart-table-total').css('display',function(i,v){return this.style.display=='table-row'?'none':'table-row';});$(this).find('td span.cart-toggle-element').css('visibility',function(i,v){return this.style.visibility=='visible'?'hidden':'visible';});});$('#shopping-cart').shoppingCart({delegates:{cartModal:'',cartContent:'#cart-details',buyButton:'',removeButton:'.clear-item',},urls:{cartContent:cartContentUrl,},callbacks:{onCounterUpdated:function(cnt){this.hide();if(cnt==0){$('#checkout-modal-btn').addClass('disabled').attr('aria-disabled',true);}else{$('#checkout-modal-btn').removeClass('disabled').attr('aria-disabled',false);}},}});