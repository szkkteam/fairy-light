{% extends 'website/layout.html' %}
{% from 'website/macros.html' import separator with context %}
{% import 'modules/breadcrumb_m.html' as breadcrumb_m with context %}
{% import 'modules/cards.html' as card with context %}

{% block custom_css %}
    {{ super() }}
    <link href="{{ site_static.url(filename='site/css/shop/style.css') }}" rel="stylesheet">
    
    <style>       

        #cart {
            padding-top: 50px;
        }

        #cart .cart-title {
            padding-bottom: 20px;
        }

        #cart tr.cart-table-album {
            cursor: pointer;
            -webkit-user-select: none;
            /* Chrome all / Safari all */
            -moz-user-select: none;
            /* Firefox all */
            -ms-user-select: none;
            /* IE 10+ */
            user-select: none;
            /* Likely future */
        }

        #cart .cart-album-title {
            white-space: nowrap;
        }

        #cart .cart-album-remark {
            white-space: nowrap;
            text-align: right;
        }

        #cart .cart-price {
            white-space: nowrap;
            text-align: left;
        }

        #cart .cart-photo {
            width: 70px;
        }

        #cart tr.cart-table-album td:last-of-type:after {
            content: "\002b";
            position: relative;
            top: 1px;
            display: inline-block;
            font-family: 'Glyphicons Halflings';
            font-style: normal;
            font-weight: 400;
            line-height: 1;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            float: right;
            color: #999;
            text-align: center;
            padding: 3px;
            transition: transform .25s linear;
            -webkit-transition: -webkit-transform .25s linear;
        }

        #cart tr.cart-table-album.active td:last-of-type:after {
            content: "\2212";
        }

        #cart .btn-point-left {
            margin-left: 50px;
            width: 160px;
        }

        #cart .btn-point-left::before {
            content: "<";
        }

        #cart .btn-point-right {
            margin-right: 50px;
            width: 160px;
        }

        #cart .btn-point-right::after {
            content: ">";
        }

        #cart .cart-discount del {
            /*color: rgba(255,0,0, 0.5);*/
            text-decoration: none;
            position: relative;
        }
        #cart .cart-discount del::before {
            content: " ";
            display: block;
            width: 100%;
            border-top: 4px solid rgba(255,0,0, 0.8);
            height: 12px;
            position: absolute;
            bottom: 0;
            left: 0;
            visibility: inherit;
            transform: rotate(-7deg);
        }
        #cart .cart-discount ins {
            color: green;
            text-decoration: none;
            padding-right: 1em;
        }

        #cart .cart-toggle-element {
            visibility: hidden;
        }

    </style>

{% endblock %}

{% block main_block %}
<section id="cart">
    <div class="container">
        <div class="row">
            <div class="col">
                <h3 class="cart-title">Shopping Cart Content:</h3>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <span id="cart-details">
                    {% include 'cart_detail.html' %}
                </span>
                <hr class="header-separator"/>
                <div class="row my-3">
                    <div class="col text-left">
                        <a href="{{return_url}}" class="btn btn-primary btn-point-left" id="shopping-cart-back">
                            <span class="text-nowrap">Continue Shopping</span>
                        </a>
                    </div>
                    <div class="col text-right">
                        <a href="{{url_for('shop.checkout')}}" class="btn btn-primary btn-point-right" id="shopping-cart-checkout">
                            <span class="text-nowrap">Check Out</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

{% endblock %}

{% block tail_js %}
    {{ super() }}

    <script src="{{ site_static.url(filename='site/js/shopping_cart.js') }}" type="text/javascript"></script>
    <script>
    
    $('#cart-details').shoppingCart({
        buyButton: null,
        clearButton: null,
        removeButton: '.clear-item',
        indicator: null,
        urlGetCartContent: "{{url_for('shop.cart_detail_refresh')}}",
    });   

    $(document).ready(function() {

        //Fixing jQuery Click Events for the iPad
        var ua = navigator.userAgent, event = (ua.match(/iPad/i)) ? "touchstart" : "click";
        var e = $('#cart tr.cart-table-album');
        $(document.body).on(event, '#cart tr.cart-table-album', function() {
            $(this).toggleClass("active", "").nextUntil('.cart-table-album, .cart-table-total').css('display', function(i, v){
                return this.style.display == 'table-row'? 'none' : 'table-row';
            });
            $(this).find('td span.cart-toggle-element').css('visibility', function(i, v) {
                return this.style.visibility == 'visible'? 'hidden' : 'visible';
            });
        });

    });
    
    </script>
{% endblock %}


